<!DOCTYPE html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>缓冲分析</title>
    <script type="text/javascript" src="./js/thirdparty.js"></script>
    <script type="text/javascript" src="./js/require.min.js" data-main="./js/main"></script>

    <style>
        html,
        body,
        #earthContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #toolbar {
            width: 100%;
            height: auto;
            position: absolute;
            left: 20px;
            top: 20px;
        }

        #options {
            background: #0000009c;
            color: white;
            border: 1px solid #444;
            color: #edffff;
            padding: 10px;
            width: 268px;
            margin: 10px;

        }
    </style>
</head>

<body>
    <div id='earthContainer'></div>
    <div id='toolbar'>

    </div>
    <script>
        //Sandcastle_Begin
        function onload() {



            //初始化地球
            var viewer = new CTMap.Viewer('earthContainer');
            var img_google = new CTMap.UrlTemplateImageryProvider({
                subdomains: ["1", "2", "3"],
                url: "http://mt{s}.google.cn/vt/lyrs=y&hl=zh-CN&x={x}&y={y}&z={z}"
            });

            var layers = viewer.scene.imageryLayers;
            layers.addImageryProvider(new CTMap.ArcGisMapServerImageryProvider({
                        url : 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer'
                    }));

            // 加载三维模型灰模
            var tileset = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({
                url: dataUrls.dataHome + 'building_texture/tileset.json'
            }))

            tileset.readyPromise.then(function (tileset) {
                viewer.scene.primitives.add(tileset);
                var pos = new CTMap.Cartesian3(-2178370.620926558,  4389894.5764546525,  4071969.2508621397);
                viewer.camera.flyTo({
                    destination: pos,
                    orientation: {
                        heading: 1.4891497571513783,
                        pitch:-0.9629392663560408,
                        roll:0.005767527415775575
                    }
                });

            }).otherwise(function (error) {
                console.log(error)
            })


            var lineData = [-2178472.1503996626, 4388396.919359643, 4070039.53913032, -2180011.073904667,
                4387602.954760594, 4070071.321063655, -2179440.854375407, 4386613.513164643, 4071433.807960764, -
                2178773.4901897986, 4386949.880810984, 4071428.609613223, -2179078.391324606, 4387497.079082163,
                4070680.764899191, -2178608.6310215886, 4387735.471589396, 4070675.288243887, -2178571.546629965,
                4387755.052690153, 4070674.038453772, -2178263.9897818053, 4387202.126741017, 4071429.423785422
            ];
            var lineBuffer = [
                116.40605611337533, 39.91500187453633,
                116.41039411522424, 39.91504715097442,
                116.41008264957183, 39.92292744091667,
                116.4100985362305, 39.923103235142364,
                116.41015942445452, 39.92327315106884,
                116.41026291097491, 39.923430482152355,
                116.41040491116044, 39.92356901861398,
                116.41057982023875, 39.92368329252411,
                116.41078073451764, 39.923768793602356,
                116.41099972387505, 39.9238221472187,
                116.41122814476246, 39.923841247573066,
                116.41996987530014, 39.92390230158651,
                116.420191389099, 39.92388745548888,
                116.42040510433397, 39.92384037446101,
                116.4206031213881, 39.923762798708374,
                116.42077812090086, 39.92365759558799,
                116.42092363431556, 39.92352865363572,
                116.42103428297854, 39.9233807388504,
                116.42110597695185, 39.92321931854427,
                116.42113606619083, 39.92305035926843,
                116.42195953330359, 39.90705161765641,
                116.42194587739378, 39.90687630868702,
                116.42188747092816, 39.90670649756871,
                116.42178660262473, 39.90654883859134,
                116.42164722511276, 39.906409509889514,
                116.42147480004483, 39.90629397132996,
                116.42127608407633, 39.90620675054125,
                116.42105886409887, 39.90615126547377,
                116.42083165210288, 39.90612969044622,
                116.40058296230312, 39.90575653050111,
                116.40035686025631, 39.9057694158486,
                116.40013837972016, 39.905815890642714,
                116.39993591677917, 39.90589416881747,
                116.39975725197061, 39.906001242084,
                116.3996092512829, 39.90613299555295,
                116.39949760229942, 39.906284365886236,
                116.39942659562806, 39.90644953589753,
                116.39939896001532, 39.90662215812006,
                116.39941575748232, 39.90679559874772,
                116.3994763425118, 39.906963192573336,
                116.39957838685511, 39.90711849912585,
                116.39971796900532, 39.907255550164074,
                116.39988972489869, 39.90736907901724,
                116.40008705405253, 39.907454722961326,
                116.40030237321818, 39.90750919085692,
                116.40052740780082, 39.90753038960922,
                116.41960188363078, 39.90788190110216,
                116.41886900815253, 39.92212059231771,
                116.41243049891668, 39.922075623302604,
                116.41274180382294, 39.914199302601034,
                116.41272602621487, 39.9140239774624,
                116.4126654959835, 39.91385447814484,
                116.41256258882417, 39.91369745723811,
                116.41242134364522, 39.91355907761678,
                116.41224730404862, 39.91344477054301,
                116.41204730075432, 39.91335902247991,
                116.41182918350744, 39.913305198986365,
                116.41160151299097, 39.91328541260784,
                116.40545522332576, 39.91322126111374,
                116.40497957553885, 39.91320702115241,
                116.40475194687514, 39.91321746248548,
                116.40453141367261, 39.91326195757408,
                116.40432654913224, 39.91333877661331,
                116.40414531733774, 39.91344493317012,
                116.40399476365269, 39.91357630029629,
                116.40388074083302, 39.91372777098236,
                116.40380768150176, 39.913893456711754,
                116.40377842583138, 39.914066916393445,
                116.40343244833474, 39.922937352568695,
                116.40344791476963, 39.92311082470008,
                116.4035072128656, 39.92327864916566,
                116.40360806383009, 39.923434376629736,
                116.40374659201709, 39.923572022674826,
                116.40391747386607, 39.92368629776402,
                116.40411414248337, 39.923772810496104,
                116.40432904000436, 39.92382823634539,
                116.40455390803781, 39.92385044540469,
                116.40478010503129, 39.923838584224605,
                116.40499893836123, 39.92379310860628,
                116.40520199838545, 39.92371576608782,
                116.40538148162109, 39.92360952879718,
                116.40553049062808, 39.92347847925049,
                116.40564329907386, 39.92332765348195,
                116.4057155717931, 39.92316284753114,
                116.40574453138571, 39.92299039472127,
                116.40605611337533, 39.91500187453633
            ];


            let pointBuffer = [116.40489227998981, 39.90664346579634,
                116.4048089439267, 39.90599440785345,
                116.40456213829557, 39.90537028704407,
                116.40416134769845, 39.90479508897743,
                116.40362197429316, 39.904290919684016,
                116.40296474589721, 39.903877155866205,
                116.40221491942927, 39.903569699994634,
                116.40140131030002, 39.90338036891734,
                116.40055518505197, 39.90331643951796,
                116.39970905980393, 39.90338036891734,
                116.39889545067467, 39.903569699994634,
                116.39814562420675, 39.903877155866205,
                116.3974883958108, 39.904290919684016,
                116.3969490224055, 39.90479508897743,
                116.39654823180837, 39.90537028704407,
                116.39630142617726, 39.90599440785345,
                116.39621809011413, 39.90664346579634,
                116.39630142617726, 39.90729251759008,
                116.39654823180837, 39.907916620888116,
                116.3969490224055, 39.90849179274718,
                116.3974883958108, 39.908995931126654,
                116.39814562420675, 39.90940966403051,
                116.39889545067467, 39.90971709369452,
                116.39970905980393, 39.90990640726046,
                116.40055518505197, 39.90997033051068,
                116.40140131030002, 39.90990640726046,
                116.40221491942927, 39.90971709369452,
                116.40296474589721, 39.90940966403051,
                116.40362197429316, 39.908995931126654,
                116.40416134769845, 39.90849179274718,
                116.40456213829557, 39.907916620888116,
                116.4048089439267, 39.90729251759008,
                116.40489227998981, 39.90664346579634
            ];


            Sandcastle.addToolbarButton('点缓冲', function () {

                let pPoint= viewer.entities.add({
                    position:new CTMap.Cartesian3.fromDegrees(116.40055518505197, 39.90664346579635),
                    point: {
                        pixelSize:20, 
                        color:  CTMap.Color.WHITE
                    }

                });

                let pBuffer = viewer.entities.add({
                    polygon: {
                        hierarchy: new CTMap.PolygonHierarchy(CTMap.Cartesian3.fromDegreesArray(
                            pointBuffer)),
                        width: 6.0,
                        material: CTMap.Color.LIME.withAlpha(0.4),
                    }

                });


            });

            Sandcastle.addToolbarButton('线缓冲', function () {
                let pl = viewer.entities.add({
                    polyline: {
                        positions: CTMap.Cartesian3.unpackArray(lineData, []),
                        width: 6.0,
                        clampToGround:true,
                        material: CTMap.Color.WHITE.withAlpha(0.7),
                    }

                });

                let plBuffer = viewer.entities.add({
                    polygon: {
                        hierarchy: new CTMap.PolygonHierarchy(CTMap.Cartesian3.fromDegreesArray(
                            lineBuffer)),
                        width: 6.0,
                        material: CTMap.Color.RED.withAlpha(0.4),
                    }

                });



            });

          
            Sandcastle.addToolbarButton('清除', function () {
                viewer.entities.removeAll();
            });

            Sandcastle.finishedLoading();



        }

        //Sandcastle_End
    </script>
</body>